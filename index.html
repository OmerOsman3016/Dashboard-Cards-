<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="description" content="Sudan Displacement Trends" />
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .dashboard-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
      justify-content: center;
    }
    
    .dashboard-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      width: 220px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-top: 5px solid var(--card-color);
    }
    
    .card-icon {
      width: 40px;
      height: 40px;
      background-color: rgba(42, 129, 203, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    
    .card-icon-img {
      width: 24px;
      height: 24px;
    }
    
    .dashboard-card h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #333;
    }
    
    .value {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #222;
    }
    
    .change {
      font-size: 14px;
      margin-bottom: 10px;
    }
    
    .positive {
      color: #5CB85C;
    }
    
    .negative {
      color: #D9534F;
    }
    
    .card-footer {
      font-size: 12px;
      color: #777;
    }
    
    .frame-container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    #timelineChart {
      height: 500px;
    }
    
    .timeline-controls {
      margin-top: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 5px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .timeline-control-button {
      padding: 8px 15px;
      background: #418FDE;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .timeline-control-button i {
      font-size: 14px;
    }
    
    #timeline-slider {
      flex-grow: 1;
      max-width: 500px;
      min-width: 200px;
    }
    
    #timeline-time-display {
      font-weight: bold;
      color: #418FDE;
      min-width: 80px;
      text-align: center;
    }
    
    .speed-control {
      display: flex;
    }
    
    .speed-control button {
      padding: 5px 10px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      cursor: pointer;
    }
    
    .speed-control button:first-child {
      border-radius: 4px 0 0 4px;
    }
    
    .speed-control button:last-child {
      border-radius: 0 4px 4px 0;
      border-left: none;
    }
    
    .data-toggle {
      display: flex;
      gap: 5px;
    }
    
    .data-toggle button {
      padding: 5px 10px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .data-toggle button.active {
      background: #418FDE;
      color: white;
      border-color: #418FDE;
    }
  </style>
</head>

<body>
   
  <!-- Dashboard Cards Container -->
  <div class="dashboard-cards">
    <!-- Card 1: Internally Displaced Persons -->
    <div class="dashboard-card" style="--card-color: #2A81CB;">
      <div class="card-icon">
        <img src="./data/Internally displaced.png" alt="IDP Icon" class="card-icon-img">
      </div>
      <h3>Internally Displaced</h3>
      <div class="value">11,301,340</div>
      <div class="change negative">
        <i class="fas fa-arrow-down"></i> 1.7% since last update
      </div>
      <div class="card-footer">Nationwide</div>
    </div>

    <!-- Card 2: Returnees -->
    <div class="dashboard-card" style="--card-color: #5CB85C;">
      <div class="card-icon">
        <img src="./data/Returnees.png" alt="IDP Icon" class="card-icon-img">
      </div>
      <h3>Returnees</h3>
      <div class="value">396,738</div>
      <div class="change positive">
        <i class="fas fa-arrow-up"></i> 0.0% since last update
      </div>
      <div class="card-footer">Nationwide</div>
    </div>

    <!-- Card 3: Crossing Border -->
    <div class="dashboard-card" style="--card-color: #F0AD4E;">
      <div class="card-icon">
        <img src="./data/Crossing Border.png" alt="IDP Icon" class="card-icon-img">
      </div>
      <h3>Crossing Border</h3>
      <div class="value">3,934,086</div>
      <div class="change positive">
        <i class="fas fa-arrow-up"></i> 0.8% since last update
      </div>
      <div class="card-footer">Neighboring countries</div>
    </div>

    <!-- Card 4: Migrants Affected -->
    <div class="dashboard-card" style="--card-color: #D9534F;">
      <div class="card-icon">
        <img src="./data/Crossing Border.png" alt="IDP Icon" class="card-icon-img">  
      </div>
      <h3>Migrants Affected</h3>
      <div class="value">400,000</div>
      <div class="change negative">
        <i class="fas fa-arrow-down"></i> 2.1% since last update
      </div>
      <div class="card-footer">Migrants</div>
    </div>

    <!-- Card 5: Locations Covered -->
    <div class="dashboard-card" style="--card-color: #5BC0DE;">
      <div class="card-icon">
        <img src="./data/Location.png" alt="IDP Icon" class="card-icon-img">  
      </div>
      <h3>Locations Covered</h3>
      <div class="value">10,285</div>
      <div class="change positive">
        <i class="fas fa-arrow-up"></i> 1.2% since last update
      </div>
      <div class="card-footer">Across Sudan</div>
    </div>
  </div>

  <!-- Improved Timeline Visualization -->
  <div class="frame-container">
    <h2 style="margin-top: 0; color: #333;">Displacement Trends Timeline</h2>
    <div id="timelineChart"></div>
    <div class="timeline-controls">
      <button id="timeline-play-button" class="timeline-control-button">
        <i class="fas fa-play"></i> Play
      </button>
      <input type="range" id="timeline-slider" min="0" max="23" value="0" step="1">
      <span id="timeline-time-display">Apr-2023</span>
      
      <div class="speed-control">
        <button id="timeline-speed-slower" title="Slower">
          <i class="fas fa-minus"></i>
        </button>
        <button id="timeline-speed-faster" title="Faster">
          <i class="fas fa-plus"></i>
        </button>
      </div>
      
      <div class="data-toggle">
        <button id="toggle-idps" class="active">IDPs</button>
        <button id="toggle-returnees" class="active">Returnees</button>
        <button id="toggle-border" class="active">Border Crossings</button>
      </div>
      
      <button id="timeline-export-button" class="timeline-control-button">
        <i class="fas fa-download"></i> Export
      </button>
    </div>
  </div>

  <!-- Plotly JS -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  
  <script>
    // Data from the table
    const timelineData = [
      { date: 'Apr-23', idps: 3200000, returnees: 50000, border_crossings: 800000 },
      { date: 'May-23', idps: 3450000, returnees: 75000, border_crossings: 900000 },
      { date: 'Jun-23', idps: 3800000, returnees: 100000, border_crossings: 1000000 },
      { date: 'Jul-23', idps: 4100000, returnees: 150000, border_crossings: 1100000 },
      { date: 'Aug-23', idps: 4350000, returnees: 200000, border_crossings: 1200000 },
      { date: 'Sep-23', idps: 4600000, returnees: 250000, border_crossings: 1300000 },
      { date: 'Oct-23', idps: 4900000, returnees: 300000, border_crossings: 1400000 },
      { date: 'Nov-23', idps: 5200000, returnees: 350000, border_crossings: 1500000 },
      { date: 'Dec-23', idps: 5500000, returnees: 400000, border_crossings: 1600000 },
      { date: 'Jan-24', idps: 5800000, returnees: 450000, border_crossings: 1700000 },
      { date: 'Feb-24', idps: 6100000, returnees: 500000, border_crossings: 1800000 },
      { date: 'Mar-24', idps: 6400000, returnees: 550000, border_crossings: 1900000 },
      { date: 'Apr-24', idps: 6700000, returnees: 600000, border_crossings: 2000000 },
      { date: 'May-24', idps: 7000000, returnees: 650000, border_crossings: 2100000 },
      { date: 'Jun-24', idps: 7300000, returnees: 750000, border_crossings: 2200000 },
      { date: 'Jul-24', idps: 7600000, returnees: 800000, border_crossings: 2300000 },
      { date: 'Aug-24', idps: 7900000, returnees: 850000, border_crossings: 2400000 },
      { date: 'Sep-24', idps: 8200000, returnees: 900000, border_crossings: 2500000 },
      { date: 'Oct-24', idps: 8500000, returnees: 950000, border_crossings: 2600000 },
      { date: 'Nov-24', idps: 8800000, returnees: 1000000, border_crossings: 2650000 },
      { date: 'Dec-24', idps: 9100000, returnees: 1050000, border_crossings: 2700000 },
      { date: 'Jan-25', idps: 9300000, returnees: 1150000, border_crossings: 2750000 },
      { date: 'Feb-25', idps: 9350000, returnees: 1150000, border_crossings: 2780000 },
      { date: 'Mar-25', idps: 9400000, returnees: 1200000, border_crossings: 2800000 }
    ];

    // Extract dates for x-axis
    const dates = timelineData.map(item => item.date);
    
    // Initialize chart
    const timelineElement = document.getElementById('timelineChart');
    let currentFrame = 0;
    let isPlaying = false;
    let playInterval;
    let playSpeed = 1000; // Default speed in ms
    let showIdps = true;
    let showReturnees = true;
    let showBorder = true;
    
    // Colors for the lines
    const colors = {
      idps: '#2A81CB',
      returnees: '#5CB85C',
      border: '#F0AD4E'
    };
    
    // Initialize the chart
    function initTimeline() {
      const data = getVisibleTraces();
      
      const layout = {
        title: 'Displacement Trends Over Time',
        xaxis: {
          title: 'Month',
          range: [0, 5] // Show first 6 months initially
        },
        yaxis: {
          title: 'Number of People',
          rangemode: 'tozero'
        },
        legend: {
          orientation: 'h',
          y: -0.2
        },
        hovermode: 'closest',
        margin: { t: 50, b: 80, l: 60, r: 40 },
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        }
      };
      
      Plotly.newPlot(timelineElement, data, layout);
      updateTimeDisplay(0);
    }
    
    // Get traces to show based on toggle buttons
    function getVisibleTraces() {
      const traces = [];
      
      if (showIdps) {
        traces.push({
          x: dates.slice(0, currentFrame + 1),
          y: timelineData.slice(0, currentFrame + 1).map(d => d.idps),
          name: 'IDPs',
          mode: 'lines+markers',
          line: { color: colors.idps, width: 3 },
          marker: { size: 8 }
        });
      }
      
      if (showReturnees) {
        traces.push({
          x: dates.slice(0, currentFrame + 1),
          y: timelineData.slice(0, currentFrame + 1).map(d => d.returnees),
          name: 'Returnees',
          mode: 'lines+markers',
          line: { color: colors.returnees, width: 3 },
          marker: { size: 8 }
        });
      }
      
      if (showBorder) {
        traces.push({
          x: dates.slice(0, currentFrame + 1),
          y: timelineData.slice(0, currentFrame + 1).map(d => d.border_crossings),
          name: 'Border Crossings',
          mode: 'lines+markers',
          line: { color: colors.border, width: 3 },
          marker: { size: 8 }
        });
      }
      
      return traces;
    }
    
    // Update the chart for current frame
    function updateTimeline(frame) {
      currentFrame = frame;
      const data = getVisibleTraces();
      
      // Calculate appropriate x-axis range to show context
      const rangeStart = Math.max(0, frame - 5);
      const rangeEnd = Math.min(dates.length - 1, rangeStart + 5);
      
      const layoutUpdate = {
        xaxis: { range: [rangeStart, rangeEnd] }
      };
      
      Plotly.animate(timelineElement, {
        data: data,
        layout: layoutUpdate
      }, {
        transition: {
          duration: 500,
          easing: 'cubic-in-out'
        },
        frame: {
          duration: 500
        }
      });
      
      updateTimeDisplay(frame);
    }
    
    // Update the time display
    function updateTimeDisplay(frame) {
      document.getElementById('timeline-time-display').textContent = timelineData[frame].date;
      document.getElementById('timeline-slider').value = frame;
    }
    
    // Play/Pause the animation
    function togglePlay() {
      isPlaying = !isPlaying;
      
      if (isPlaying) {
        document.getElementById('timeline-play-button').innerHTML = '<i class="fas fa-pause"></i> Pause';
        playInterval = setInterval(() => {
          const nextFrame = (currentFrame + 1) % timelineData.length;
          if (nextFrame === 0) {
            // Reached end, stop playing
            togglePlay();
          } else {
            updateTimeline(nextFrame);
          }
        }, playSpeed);
      } else {
        document.getElementById('timeline-play-button').innerHTML = '<i class="fas fa-play"></i> Play';
        clearInterval(playInterval);
      }
    }
    
    // Event Listeners
    document.getElementById('timeline-slider').addEventListener('input', (e) => {
      if (isPlaying) togglePlay();
      updateTimeline(parseInt(e.target.value));
    });
    
    document.getElementById('timeline-play-button').addEventListener('click', togglePlay);
    
    document.getElementById('timeline-speed-slower').addEventListener('click', () => {
      playSpeed = Math.min(3000, playSpeed + 200);
    });
    
    document.getElementById('timeline-speed-faster').addEventListener('click', () => {
      playSpeed = Math.max(200, playSpeed - 200);
    });
    
    document.getElementById('toggle-idps').addEventListener('click', () => {
      showIdps = !showIdps;
      this.classList.toggle('active');
      updateTimeline(currentFrame);
    });
    
    document.getElementById('toggle-returnees').addEventListener('click', function() {
      showReturnees = !showReturnees;
      this.classList.toggle('active');
      updateTimeline(currentFrame);
    });
    
    document.getElementById('toggle-border').addEventListener('click', function() {
      showBorder = !showBorder;
      this.classList.toggle('active');
      updateTimeline(currentFrame);
    });
    
    document.getElementById('timeline-export-button').addEventListener('click', () => {
      Plotly.downloadImage(timelineElement, {
        format: 'png',
        width: 1200,
        height: 800,
        filename: `displacement-trends-${timelineData[currentFrame].date}`
      });
    });
    
    // Initialize on load
    window.addEventListener('load', initTimeline);
  </script>
</body>
</html>
